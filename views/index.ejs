<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç…§ç‰‡åˆ†äº«ç½‘ç«™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .navigation {
            background: #333;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-radius: 10px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 20px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            background: #555;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .upload-section {
            padding: 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f8f9ff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #f0fff4;
        }

        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #666;
            font-size: 0.9rem;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .gallery {
            padding: 40px;
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .gallery-title {
            font-size: 2rem;
            color: #333;
        }

        .image-count {
            color: #666;
            font-size: 1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .image-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .image-container {
            position: relative;
            width: 100%;
            height: 250px;
            overflow: hidden;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.05);
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.7));
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: flex-end;
            padding: 20px;
        }

        .image-container:hover .image-overlay {
            opacity: 1;
        }

        .image-info {
            padding: 20px;
        }

        .image-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            word-break: break-all;
        }

        .image-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #666;
            font-size: 0.9rem;
        }

        .image-date {
            color: #888;
        }

        .image-size {
            color: #888;
        }

        .image-description {
            margin: 10px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9rem;
            line-height: 1.4;
            color: #555;
        }

        .image-tags {
            margin: 10px 0;
        }

        .tag {
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin: 2px;
        }

        .image-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .empty-gallery {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-hint {
            color: #999;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .navigation {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
            }

            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .upload-section,
            .gallery {
                padding: 20px;
            }

            .upload-area {
                padding: 30px 20px;
            }

            .grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }

            .gallery-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .image-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 0;
            width: 90%;
            max-width: 1200px;
            top: 50%;
            transform: translateY(-50%);
        }

        .modal-image {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .close:hover {
            color: #bbb;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* åˆ†æè¯¦æƒ…æ¨¡æ€æ¡† */
        .analysis-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s;
        }

        .analysis-content {
            position: relative;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            background: white;
            border-radius: 15px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .analysis-title {
            font-size: 1.5rem;
            color: #333;
        }

        .analysis-close {
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }

        .analysis-close:hover {
            color: #333;
        }

        .analysis-section {
            margin-bottom: 20px;
        }

        .analysis-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .analysis-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .analysis-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        .analysis-value {
            color: #666;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navigation">
        <h1>ğŸ“¸ æ™ºèƒ½å¤šåª’ä½“å¹³å°</h1>
        <div class="nav-links">
            <a href="/" class="nav-link active">ğŸ“¸ å›¾ç‰‡ä¸­å¿ƒ</a>
            <a href="/videos" class="nav-link">ğŸ¬ è§†é¢‘ä¸­å¿ƒ</a>
            <a href="/video-player" class="nav-link">ğŸŒ åœ¨çº¿æ’­æ”¾</a>
            <a href="/mini-browser" class="nav-link">ğŸŒ è¿·ä½ æµè§ˆå™¨</a>
            <a href="/web-proxy" class="nav-link">ğŸ”— ç½‘é¡µä»£ç†</a>
            <a href="/game24" class="nav-link">ğŸ¯ è®¡ç®—24</a>
        </div>
    </nav>

    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ“¸ ç…§ç‰‡åˆ†äº«ç½‘ç«™</h1>
            <p>ä¸Šä¼ å¹¶åˆ†äº«æ‚¨çš„ç¾å¥½ç¬é—´</p>
        </div>

        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">â˜ï¸</div>
                <div class="upload-text">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</div>
                <div class="upload-hint">æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ (æ”¯æŒ JPG, PNG, GIF, WebP æ ¼å¼ï¼Œæœ€å¤§ 5MB)</div>
                <input type="file" id="fileInput" accept="image/*" multiple>
            </div>
            
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="message" id="message"></div>
        </div>

        <!-- ç…§ç‰‡ç”»å»Š -->
        <div class="gallery">
            <div class="gallery-header">
                <h2 class="gallery-title">ç…§ç‰‡ç”»å»Š</h2>
                <div class="image-count">å…± <%= images.length %> å¼ ç…§ç‰‡</div>
            </div>

            <% if (images.length === 0) { %>
                <div class="empty-gallery">
                    <div class="empty-icon">ğŸ–¼ï¸</div>
                    <div class="empty-text">è¿˜æ²¡æœ‰ç…§ç‰‡</div>
                    <div class="empty-hint">å¿«æ¥ä¸Šä¼ ç¬¬ä¸€å¼ ç…§ç‰‡å§ï¼</div>
                </div>
            <% } else { %>
                <div class="grid" id="imageGrid">
                    <% images.forEach(function(image) { %>
                        <div class="image-card">
                            <div class="image-container">
                                <img src="/uploads/<%= image.filename %>" 
                                     alt="<%= image.filename %>" 
                                     onclick="openModal(this.src)">
                                <div class="image-overlay"></div>
                            </div>
                            <div class="image-info">
                                <div class="image-name"><%= image.filename %></div>
                                <% if (image.analysis && image.analysis.description) { %>
                                    <div class="image-description">
                                        <strong>AIåˆ†æï¼š</strong><%= image.analysis.description %>
                                    </div>
                                <% } %>
                                <div class="image-meta">
                                    <div class="image-date">
                                        <%= new Date(image.uploadDate).toLocaleDateString('zh-CN') %>
                                    </div>
                                    <div class="image-size">
                                        <%= (image.size / 1024 / 1024).toFixed(2) %> MB
                                    </div>
                                </div>
                                <% if (image.analysis && image.analysis.tags) { %>
                                    <div class="image-tags">
                                        <% image.analysis.tags.slice(0, 5).forEach(function(tag) { %>
                                            <span class="tag"><%= tag %></span>
                                        <% }); %>
                                    </div>
                                <% } %>
                                <div class="image-actions">
                                    <button class="btn" onclick="downloadImage('/uploads/<%= image.filename %>', '<%= image.filename %>')">
                                        ä¸‹è½½
                                    </button>
                                    <button class="btn" onclick="showAnalysis('<%= image.filename %>')">
                                        è¯¦ç»†åˆ†æ
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteImage('<%= image.filename %>')">
                                        åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } %>
        </div>
    </div>

    <!-- å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img class="modal-image" id="modalImage">
        </div>
    </div>

    <!-- åˆ†æè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="analysisModal" class="analysis-modal">
        <div class="analysis-content">
            <div class="analysis-header">
                <h2 class="analysis-title">ğŸ¤– å›¾ç‰‡æ™ºèƒ½åˆ†ææŠ¥å‘Š</h2>
                <span class="analysis-close" onclick="closeAnalysisModal()">&times;</span>
            </div>
            <div id="analysisDetails">
                <!-- åˆ†æå†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let isUploading = false;

        // DOM å…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.querySelector('.upload-area');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const message = document.getElementById('message');
        const imageGrid = document.getElementById('imageGrid');

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        fileInput.addEventListener('change', handleFileSelect);
        
        // æ‹–æ‹½ä¸Šä¼ 
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadFiles(files);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                uploadFiles(files);
            }
        }

        function uploadFiles(files) {
            if (isUploading) return;
            
            const validFiles = Array.from(files).filter(file => {
                const isImage = file.type.startsWith('image/');
                const isValidSize = file.size <= 5 * 1024 * 1024; // 5MB
                
                if (!isImage) {
                    showMessage('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
                    return false;
                }
                if (!isValidSize) {
                    showMessage('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB', 'error');
                    return false;
                }
                return true;
            });

            if (validFiles.length === 0) return;

            uploadFilesSequentially(validFiles);
        }

        async function uploadFilesSequentially(files) {
            isUploading = true;
            progressBar.style.display = 'block';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const progress = ((i + 1) / files.length) * 100;
                
                try {
                    await uploadSingleFile(file);
                    updateProgress(progress);
                } catch (error) {
                    console.error('ä¸Šä¼ æ–‡ä»¶å¤±è´¥:', error);
                    showMessage(`ä¸Šä¼  ${file.name} å¤±è´¥`, 'error');
                }
            }
            
            isUploading = false;
            progressBar.style.display = 'none';
            updateProgress(0);
            fileInput.value = '';
            
            // åˆ·æ–°é¡µé¢æ˜¾ç¤ºæ–°ä¸Šä¼ çš„å›¾ç‰‡
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        function uploadSingleFile(file) {
            console.log('å¼€å§‹ä¸Šä¼ æ–‡ä»¶:', file.name, file.type, file.size);
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('photo', file);

                const xhr = new XMLHttpRequest();
                
                xhr.onload = function() {
                    console.log('ä¸Šä¼ å“åº”çŠ¶æ€:', xhr.status);
                    console.log('ä¸Šä¼ å“åº”å†…å®¹:', xhr.responseText);
                    
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                showMessage(`${file.name} ä¸Šä¼ æˆåŠŸï¼`, 'success');
                                resolve(response);
                            } else {
                                console.error('æœåŠ¡å™¨è¿”å›é”™è¯¯:', response.message);
                                showMessage(`${file.name} ä¸Šä¼ å¤±è´¥: ${response.message}`, 'error');
                                reject(new Error(response.message));
                            }
                        } catch (parseError) {
                            console.error('è§£æå“åº”JSONå¤±è´¥:', parseError);
                            showMessage(`${file.name} ä¸Šä¼ å¤±è´¥: æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯`, 'error');
                            reject(new Error('å“åº”æ ¼å¼é”™è¯¯'));
                        }
                    } else {
                        console.error('HTTPé”™è¯¯çŠ¶æ€:', xhr.status, xhr.statusText);
                        showMessage(`${file.name} ä¸Šä¼ å¤±è´¥: HTTP ${xhr.status}`, 'error');
                        reject(new Error(`HTTPé”™è¯¯: ${xhr.status}`));
                    }
                };
                
                xhr.onerror = function() {
                    console.error('ç½‘ç»œé”™è¯¯');
                    showMessage(`${file.name} ä¸Šä¼ å¤±è´¥: ç½‘ç»œé”™è¯¯`, 'error');
                    reject(new Error('ç½‘ç»œé”™è¯¯'));
                };
                
                console.log('å‘é€ä¸Šä¼ è¯·æ±‚åˆ° /upload');
                xhr.open('POST', '/upload');
                xhr.send(formData);
            });
        }

        function updateProgress(percent) {
            progressFill.style.width = percent + '%';
        }

        function showMessage(text, type) {
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }

        // åˆ é™¤å›¾ç‰‡
        async function deleteImage(filename) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`/delete/${filename}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('å›¾ç‰‡åˆ é™¤æˆåŠŸ', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('åˆ é™¤å›¾ç‰‡å¤±è´¥:', error);
                showMessage('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // ä¸‹è½½å›¾ç‰‡
        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // æ˜¾ç¤ºå›¾ç‰‡åˆ†æè¯¦æƒ…
        async function showAnalysis(filename) {
            try {
                const response = await fetch(`/api/analysis/${filename}`);
                const result = await response.json();
                
                if (result.success) {
                    displayAnalysis(result.analysis, filename);
                    document.getElementById('analysisModal').style.display = 'block';
                } else {
                    showMessage('è·å–åˆ†æä¿¡æ¯å¤±è´¥: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('è·å–åˆ†æä¿¡æ¯å¤±è´¥:', error);
                showMessage('è·å–åˆ†æä¿¡æ¯å¤±è´¥', 'error');
            }
        }

        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayAnalysis(analysis, filename) {
            const detailsContainer = document.getElementById('analysisDetails');
            
            let html = `
                <div class="analysis-section">
                    <h3>ğŸ¤– AIæ™ºèƒ½æè¿°</h3>
                    <div class="analysis-item">
                        <div class="analysis-value">${analysis.description || 'æš‚æ— æè¿°'}</div>
                    </div>
                </div>`;

            // å†…å®¹åˆ†æéƒ¨åˆ†
            if (analysis.contentAnalysis) {
                html += `
                <div class="analysis-section">
                    <h3>ğŸ¯ å†…å®¹åˆ†æ</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>å†…å®¹ç±»å‹</strong>
                            <div class="analysis-value">${getContentTypeDisplay(analysis.contentAnalysis.contentType)}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>åœºæ™¯</strong>
                            <div class="analysis-value">${getSceneDisplay(analysis.contentAnalysis.scene)}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>æ„å›¾é£æ ¼</strong>
                            <div class="analysis-value">${getCompositionDisplay(analysis.contentAnalysis.composition)}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>å…‰çº¿æ•ˆæœ</strong>
                            <div class="analysis-value">${getLightingDisplay(analysis.contentAnalysis.lighting)}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>æƒ…ç»ªè‰²è°ƒ</strong>
                            <div class="analysis-value">${getMoodDisplay(analysis.contentAnalysis.mood)}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>å›¾ç‰‡è´¨é‡</strong>
                            <div class="analysis-value">${getQualityDisplay(analysis.contentAnalysis.quality)}</div>
                        </div>
                    </div>
                </div>`;

                // æŠ€æœ¯ç»†èŠ‚
                if (analysis.contentAnalysis.technicalDetails && analysis.contentAnalysis.technicalDetails.length > 0) {
                    html += `
                    <div class="analysis-section">
                        <h3>âš™ï¸ æŠ€æœ¯ç‰¹æ€§</h3>
                        <div class="analysis-grid">`;
                    analysis.contentAnalysis.technicalDetails.forEach(detail => {
                        html += `
                            <div class="analysis-item">
                                <div class="analysis-value">âœ“ ${detail}</div>
                            </div>`;
                    });
                    html += `</div></div>`;
                }
            }

            // ç‰©ä½“è¯†åˆ«éƒ¨åˆ†
            if (analysis.objectDetection && analysis.objectDetection.detectedObjects.length > 0) {
                html += `
                <div class="analysis-section">
                    <h3>ğŸ¤– AIæ™ºèƒ½ç‰©ä½“è¯†åˆ«</h3>`;
                
                // å¦‚æœæœ‰AIåˆ†æç»“æœï¼Œæ˜¾ç¤ºAIä¿¡æ¯
                if (analysis.objectDetection.aiAnalysis && analysis.objectDetection.aiAnalysis.success) {
                    html += `
                    <div class="ai-analysis-info" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 1.1em; font-weight: bold;">ğŸ§  æ·±åº¦å­¦ä¹ AIåˆ†æ</span>
                            <span style="margin-left: auto; background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">
                                æ£€æµ‹åˆ° ${analysis.objectDetection.aiAnalysis.totalDetections || 0} ä¸ªå¯¹è±¡
                            </span>
                        </div>
                        <div style="font-size: 0.95em; opacity: 0.9;">
                            æœ€é«˜ç½®ä¿¡åº¦: ${((analysis.objectDetection.aiAnalysis.maxConfidence || 0) * 100).toFixed(1)}% | 
                            å¹³å‡ç½®ä¿¡åº¦: ${((analysis.objectDetection.aiAnalysis.avgConfidence || 0) * 100).toFixed(1)}%
                        </div>
                        ${analysis.objectDetection.aiAnalysis.aiDescription ? 
                            `<div style="margin-top: 8px; font-style: italic; background: rgba(255,255,255,0.2); padding: 8px; border-radius: 4px;">
                                "${analysis.objectDetection.aiAnalysis.aiDescription}"
                            </div>` : ''}
                    </div>`;
                }
                
                html += `
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>ä¸»è¦ç‰©ä½“</strong>
                            <div class="analysis-value">${getObjectDisplay(analysis.objectDetection.primaryObject)}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>æ£€æµ‹æ•°é‡</strong>
                            <div class="analysis-value">${analysis.objectDetection.objectCount} ä¸ªç‰©ä½“</div>
                        </div>
                    </div>
                    <div class="analysis-item">
                        <strong>æ£€æµ‹åˆ°çš„ç‰©ä½“</strong>
                        <div class="analysis-value">`;
                
                analysis.objectDetection.objectDescriptions.forEach(obj => {
                    const confidence = (obj.confidence * 100).toFixed(0);
                    const confidenceColor = obj.confidence > 0.7 ? '#4CAF50' : obj.confidence > 0.5 ? '#FF9800' : '#F44336';
                    html += `
                        <div style="margin: 5px 0; padding: 8px; background: #f5f5f5; border-radius: 4px; border-left: 4px solid ${confidenceColor};">
                            <span style="font-weight: bold;">${getObjectDisplay(obj.object)}</span>
                            <span style="float: right; color: ${confidenceColor};">ç½®ä¿¡åº¦: ${confidence}%</span>
                            <div style="font-size: 0.9em; color: #666; margin-top: 2px;">${obj.description}</div>`;
                    
                    // å¦‚æœæœ‰AIå¢å¼ºçš„è¯†åˆ«ç»“æœï¼Œæ˜¾ç¤ºå…·ä½“åç§°
                    if (obj.aiDetails) {
                        html += `
                            <div style="margin-top: 5px; padding: 4px 8px; background: linear-gradient(90deg, #e3f2fd, #f3e5f5); border-radius: 3px; font-size: 0.85em;">
                                <span style="color: #1976d2;">ğŸ¯ AIè¯†åˆ«: ${obj.aiDetails.specificName}</span>
                                <span style="float: right; color: #7b1fa2;">AIç½®ä¿¡åº¦: ${(obj.aiDetails.aiConfidence * 100).toFixed(1)}%</span>
                            </div>`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>
                    </div>
                </div>`;
            }

            html += `
                <div class="analysis-section">
                    <h3>ğŸ“Š åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>æ–‡ä»¶å</strong>
                            <div class="analysis-value">${analysis.basicInfo?.filename || filename}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>æ ¼å¼</strong>
                            <div class="analysis-value">${analysis.basicInfo?.format || 'Unknown'}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>å°ºå¯¸</strong>
                            <div class="analysis-value">${analysis.basicInfo?.width || 0} Ã— ${analysis.basicInfo?.height || 0}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>åƒç´ </strong>
                            <div class="analysis-value">${analysis.basicInfo?.megapixels || 0} MP</div>
                        </div>
                        <div class="analysis-item">
                            <strong>å®½é«˜æ¯”</strong>
                            <div class="analysis-value">${analysis.basicInfo?.aspectRatio ? analysis.basicInfo.aspectRatio.toFixed(2) : 'Unknown'}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>é¢œè‰²é€šé“</strong>
                            <div class="analysis-value">${analysis.basicInfo?.channels || 'Unknown'}</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>ğŸ¨ è‰²å½©åˆ†æ</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <strong>ä¸»è¦é¢œè‰²</strong>
                            <div class="analysis-value">${analysis.colorInfo?.dominantColor || 'Unknown'}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>äº®åº¦</strong>
                            <div class="analysis-value">${analysis.colorInfo?.brightness || 'Unknown'}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>å¯¹æ¯”åº¦</strong>
                            <div class="analysis-value">${analysis.colorInfo?.contrast || 'Unknown'}</div>
                        </div>
                        <div class="analysis-item">
                            <strong>è‰²å½©ä¸°å¯Œåº¦</strong>
                            <div class="analysis-value">${analysis.colorInfo?.colorfulness || 'Unknown'}</div>
                        </div>
                    </div>
                </div>
            `;

            if (analysis.tags && analysis.tags.length > 0) {
                html += `
                    <div class="analysis-section">
                        <h3>ğŸ·ï¸ æ™ºèƒ½æ ‡ç­¾</h3>
                        <div class="analysis-item">
                            <div class="analysis-value">
                                ${analysis.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            html += `
                <div class="analysis-section">
                    <h3>â° åˆ†ææ—¶é—´</h3>
                    <div class="analysis-item">
                        <div class="analysis-value">${new Date(analysis.analysisTime).toLocaleString('zh-CN')}</div>
                    </div>
                </div>
            `;

            detailsContainer.innerHTML = html;
        }

        // å…³é—­åˆ†ææ¨¡æ€æ¡†
        function closeAnalysisModal() {
            document.getElementById('analysisModal').style.display = 'none';
        }

        // å†…å®¹åˆ†ææ˜¾ç¤ºè¾…åŠ©å‡½æ•°
        function getContentTypeDisplay(contentType) {
            const types = {
                'portrait': 'ğŸ‘¤ äººåƒæ‘„å½±',
                'landscape': 'ğŸï¸ é£æ™¯æ‘„å½±',
                'architecture': 'ğŸ¢ å»ºç­‘æ‘„å½±',
                'text_document': 'ğŸ“„ æ–‡æ¡£å›¾ç‰‡',
                'photography': 'ğŸ“¸ ä¸“ä¸šæ‘„å½±',
                'general': 'ğŸ–¼ï¸ é€šç”¨å›¾ç‰‡'
            };
            return types[contentType] || contentType;
        }

        function getSceneDisplay(scene) {
            const scenes = {
                'sky_outdoor': 'â˜€ï¸ å¤©ç©ºæˆ·å¤–',
                'nature_outdoor': 'ğŸŒ¿ è‡ªç„¶æˆ·å¤–',
                'indoor_night': 'ğŸŒ™ å®¤å†…å¤œæ™š',
                'panoramic_landscape': 'ğŸŒ„ å…¨æ™¯é£æ™¯',
                'portrait_close': 'ğŸ‘ï¸ è¿‘è·äººåƒ',
                'general_scene': 'ğŸ¬ å¸¸è§„åœºæ™¯'
            };
            return scenes[scene] || scene;
        }

        function getCompositionDisplay(composition) {
            const compositions = {
                'square_centered': 'â¬œ æ­£æ–¹å±…ä¸­',
                'panoramic_wide': 'ğŸ“ å…¨æ™¯å®½å¹…',
                'vertical_portrait': 'ğŸ“± å‚ç›´è‚–åƒ',
                'horizontal_landscape': 'ğŸ’» æ°´å¹³é£æ™¯',
                'standard_composition': 'ğŸ¯ æ ‡å‡†æ„å›¾'
            };
            return compositions[composition] || composition;
        }

        function getLightingDisplay(lighting) {
            const lightings = {
                'strong_directional': 'ğŸ’¡ å¼ºçƒˆæ–¹å‘å…‰',
                'soft_diffused': 'ğŸ•¯ï¸ æŸ”å’Œæ¼«å°„å…‰',
                'dramatic_shadow': 'ğŸ­ æˆå‰§é˜´å½±',
                'low_ambient': 'ğŸ”… ä½ç¯å¢ƒå…‰',
                'natural_balanced': 'ğŸŒ è‡ªç„¶å¹³è¡¡å…‰'
            };
            return lightings[lighting] || lighting;
        }

        function getMoodDisplay(mood) {
            const moods = {
                'energetic': 'âš¡ å……æ»¡æ´»åŠ›',
                'warm': 'ğŸ”¥ æ¸©æš–èˆ’é€‚',
                'calm': 'ğŸ˜Œ å®é™å¹³å’Œ',
                'melancholic': 'ğŸ˜” å¿§éƒæ·±æ²‰',
                'peaceful': 'â˜®ï¸ ç¥¥å’Œå¹³é™',
                'mysterious': 'ğŸ”® ç¥ç§˜è«æµ‹',
                'dramatic': 'ğŸª æˆå‰§æ€§å¼º',
                'vibrant': 'ğŸŒˆ é²œè‰³ç”ŸåŠ¨',
                'neutral': 'âš–ï¸ ä¸­æ€§å¹³è¡¡'
            };
            return moods[mood] || mood;
        }

        function getQualityDisplay(quality) {
            const qualities = {
                'excellent': 'â­â­â­â­â­ å“è¶Š',
                'good': 'â­â­â­â­ è‰¯å¥½',
                'fair': 'â­â­â­ ä¸­ç­‰',
                'basic': 'â­â­ åŸºç¡€'
            };
            return qualities[quality] || quality;
        }

        function getObjectDisplay(object) {
            const objects = {
                'person': 'ğŸ‘¤ äººç‰©',
                'vehicle': 'ğŸš— è½¦è¾†',
                'building': 'ğŸ¢ å»ºç­‘ç‰©',
                'nature': 'ğŸŒ¿ è‡ªç„¶æ™¯è§‚',
                'animal': 'ğŸ¾ åŠ¨ç‰©',
                'food': 'ğŸ½ï¸ é£Ÿç‰©',
                'text': 'ğŸ“ æ–‡å­—å†…å®¹'
            };
            return objects[object] || object;
        }

        // å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡†
        function openModal(src) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = src;
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            const analysisModal = document.getElementById('analysisModal');
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === analysisModal) {
                closeAnalysisModal();
            }
        }

        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closeAnalysisModal();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç…§ç‰‡åˆ†äº«ç½‘ç«™å·²åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>
